<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç²¾è‡´ç°è‰²æµ£ç†Šé£ç¿”å¤§å†’é™©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
        }
        
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            padding: 10px;
        }
        
        .game-container {
            position: relative;
            width: 100%;
            max-width: 450px;
            text-align: center;
        }
        
        #game-canvas {
            background: linear-gradient(to bottom, #87CEEB, #B0E0E6);
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
            display: block;
            margin: 0 auto;
        }
        
        .ui-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            pointer-events: none;
        }
        
        .screen {
            background: rgba(0, 0, 0, 0.85);
            border-radius: 20px;
            padding: 30px;
            color: white;
            text-align: center;
            max-width: 90%;
            pointer-events: auto;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .title {
            font-size: 2.5rem;
            margin-bottom: 15px;
            background: linear-gradient(to right, #C0C0C0, #A9A9A9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            font-size: 1.1rem;
            margin-bottom: 20px;
            color: #E0E0E0;
            line-height: 1.5;
        }
        
        .btn {
            background: linear-gradient(45deg, #708090, #2F4F4F);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 30px;
            font-size: 1.1rem;
            cursor: pointer;
            margin: 10px;
            font-weight: bold;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
            pointer-events: auto;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.4);
        }
        
        .score-display {
            position: absolute;
            top: 20px;
            left: 0;
            width: 100%;
            font-size: 3rem;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            z-index: 10;
        }
        
        .instructions {
            position: absolute;
            bottom: 30px;
            left: 0;
            width: 100%;
            font-size: 1rem;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
            z-index: 10;
        }
        
        .hidden {
            display: none;
        }
        
        .stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .stat-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 15px;
            min-width: 100px;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #C0C0C0;
        }
        
        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        @media (max-width: 480px) {
            .title {
                font-size: 2rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .btn {
                padding: 10px 25px;
                font-size: 1rem;
            }
            
            .score-display {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <canvas id="game-canvas" width="400" height="600"></canvas>
        
        <div class="score-display">0</div>
        <div class="instructions">ç‚¹å‡»å±å¹•æˆ–æŒ‰ç©ºæ ¼é”®è®©æµ£ç†Šé£ç¿”</div>
        
        <div class="ui-container">
            <div id="start-screen" class="screen">
                <h1 class="title">ğŸ¦ ç²¾è‡´æµ£ç†Šå¤§å†’é™©</h1>
                <p class="subtitle">å¸®åŠ©å¯çˆ±çš„ç°è‰²æµ£ç†Šç©¿è¶Šæ£®æ—<br>ä½“éªŒç²¾å‡†çš„è§’è‰²è®¾è®¡</p>
                <button id="start-btn" class="btn">å¼€å§‹æ¸¸æˆ</button>
                
                <div class="stats">
                    <div class="stat-box">
                        <div class="stat-value" id="high-score-display">0</div>
                        <div class="stat-label">æœ€é«˜åˆ†</div>
                    </div>
                </div>
            </div>
            
            <div id="game-over-screen" class="screen hidden">
                <h1 class="title">æ¸¸æˆç»“æŸ!</h1>
                <p class="subtitle">æœ€ç»ˆå¾—åˆ†: <span id="final-score">0</span></p>
                
                <div class="stats">
                    <div class="stat-box">
                        <div class="stat-value" id="passed-pipes">0</div>
                        <div class="stat-label">ç©¿è¶Šç®¡é“</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="collected-berries">0</div>
                        <div class="stat-label">æ”¶é›†æµ†æœ</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="game-high-score">0</div>
                        <div class="stat-label">æœ€é«˜åˆ†</div>
                    </div>
                </div>
                
                <button id="restart-btn" class="btn">å†ç©ä¸€æ¬¡</button>
                <button id="menu-btn" class="btn">ä¸»èœå•</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('game-canvas');
            const ctx = canvas.getContext('2d');
            
            // DOMå…ƒç´ 
            const startScreen = document.getElementById('start-screen');
            const gameOverScreen = document.getElementById('game-over-screen');
            const startBtn = document.getElementById('start-btn');
            const restartBtn = document.getElementById('restart-btn');
            const menuBtn = document.getElementById('menu-btn');
            const scoreDisplay = document.querySelector('.score-display');
            const finalScoreDisplay = document.getElementById('final-score');
            const passedPipesDisplay = document.getElementById('passed-pipes');
            const collectedBerriesDisplay = document.getElementById('collected-berries');
            const highScoreDisplay = document.getElementById('high-score-display');
            const gameHighScoreDisplay = document.getElementById('game-high-score');
            
            // æ¸¸æˆå¸¸é‡ - å¢å¤§ç®¡é“é—´è·ä»160åˆ°220
            const GRAVITY = 0.5;
            const JUMP_FORCE = -10;
            const PIPE_WIDTH = 70;
            const PIPE_GAP = 220;  // ä»160å¢å¤§åˆ°220ï¼Œå¢åŠ 60åƒç´ çš„é—´è·
            const PIPE_SPEED = 3;
            const BERRY_SIZE = 15;
            const BERRY_SPAWN_CHANCE = 0.4;
            
            // æ¸¸æˆå˜é‡
            let raccoon = {
                x: 100,
                y: canvas.height / 2,
                bodyWidth: 40,
                bodyHeight: 30,
                headRadius: 18,
                velocity: 0,
                
                // ç²¾å‡†å®šä½çš„æµ£ç†Šç»˜åˆ¶æ–¹æ³• - è¶…è¿‡300è¡Œ
                draw() {
                    // ä¿å­˜çŠ¶æ€
                    ctx.save();
                    
                    // ===============================
                    // 1. èº«ä½“ä¸»éƒ¨ä»¶ - ç²¾å‡†å®šä½
                    // ===============================
                    
                    const bodyCenterX = this.x;
                    const bodyCenterY = this.y + 5;
                    
                    // èº«ä½“ä¸»ä½“ - æ·±ç°è‰²
                    ctx.fillStyle = '#696969';
                    ctx.beginPath();
                    ctx.ellipse(bodyCenterX, bodyCenterY, this.bodyWidth/2, this.bodyHeight/2, 0, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // èº«ä½“å†…å±‚ - ä¸­ç°è‰²
                    ctx.fillStyle = '#808080';
                    ctx.beginPath();
                    ctx.ellipse(bodyCenterX, bodyCenterY + 2, this.bodyWidth/2 * 0.8, this.bodyHeight/2 * 0.8, 0, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // è…¹éƒ¨æµ…ç°è‰²
                    ctx.fillStyle = '#A9A9A9';
                    ctx.beginPath();
                    ctx.ellipse(bodyCenterX, bodyCenterY + 6, this.bodyWidth/2 * 0.6, this.bodyHeight/2 * 0.6, 0, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // èº«ä½“æ¯›å‘çº¹ç†
                    ctx.fillStyle = '#2F4F4F';
                    for (let i = 0; i < 8; i++) {
                        const angle = (i / 8) * Math.PI * 2;
                        const radiusX = this.bodyWidth/2 * 0.7;
                        const radiusY = this.bodyHeight/2 * 0.7;
                        const spotX = bodyCenterX + Math.cos(angle) * radiusX;
                        const spotY = bodyCenterY + Math.sin(angle) * radiusY;
                        const spotSize = Math.random() * 2 + 1;
                        ctx.beginPath();
                        ctx.arc(spotX, spotY, spotSize, 0, Math.PI * 2);
                        ctx.fill();
                    }
                    
                    // ===============================
                    // 2. å¤´éƒ¨ç³»ç»Ÿ - åŸºäºèº«ä½“å®šä½
                    // ===============================
                    
                    const headX = bodyCenterX + this.bodyWidth/2 + 2;
                    const headY = bodyCenterY - 8;
                    
                    // å¤´éƒ¨åŸºç¡€ - æ·±ç°è‰²
                    ctx.fillStyle = '#696969';
                    ctx.beginPath();
                    ctx.arc(headX, headY, this.headRadius, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // å¤´éƒ¨å†…å±‚ - ä¸­ç°è‰²
                    ctx.fillStyle = '#808080';
                    ctx.beginPath();
                    ctx.arc(headX, headY, this.headRadius * 0.85, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // é¢éƒ¨ç™½è‰²åŒºåŸŸ
                    ctx.fillStyle = '#F5F5F5';
                    ctx.beginPath();
                    ctx.ellipse(headX + 1, headY - 1, this.headRadius * 0.7, this.headRadius * 0.8, 0.1, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // ===============================
                    // 3. çœ¼éƒ¨ç³»ç»Ÿ - åŸºäºå¤´éƒ¨å®šä½
                    // ===============================
                    
                    // å·¦çœ¼çœ¼çœ¶
                    ctx.fillStyle = '#000000';
                    ctx.beginPath();
                    ctx.arc(headX - 5, headY - 3, 6, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // å³çœ¼çœ¼çœ¶
                    ctx.beginPath();
                    ctx.arc(headX + 7, headY - 3, 6, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // çœ¼çƒç™½è‰²
                    ctx.fillStyle = '#FFFFFF';
                    ctx.beginPath();
                    ctx.arc(headX - 5, headY - 3, 4, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(headX + 7, headY - 3, 4, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // ç³å­”é»‘è‰²
                    ctx.fillStyle = '#000000';
                    ctx.beginPath();
                    ctx.arc(headX - 5, headY - 3, 2, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(headX + 7, headY - 3, 2, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // çœ¼çƒé«˜å…‰
                    ctx.fillStyle = '#FFFFFF';
                    ctx.beginPath();
                    ctx.arc(headX - 6, headY - 4, 1, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(headX + 6, headY - 4, 1, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // çœ‰æ¯›
                    ctx.strokeStyle = '#2F4F4F';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(headX - 5, headY - 9, 8, 0.2 * Math.PI, 0.8 * Math.PI);
                    ctx.stroke();
                    ctx.beginPath();
                    ctx.arc(headX + 7, headY - 9, 8, 0.2 * Math.PI, 0.8 * Math.PI);
                    ctx.stroke();
                    
                    // ===============================
                    // 4. é¼»å­ç³»ç»Ÿ - åŸºäºé¢éƒ¨å®šä½
                    // ===============================
                    
                    const noseX = headX + 9;
                    const noseY = headY + 2;
                    
                    // é¼»å­ä¸»ä½“
                    ctx.fillStyle = '#000000';
                    ctx.beginPath();
                    ctx.ellipse(noseX, noseY, 3, 2.5, 0, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // é¼»å­é«˜å…‰
                    ctx.fillStyle = '#404040';
                    ctx.beginPath();
                    ctx.ellipse(noseX - 1, noseY - 0.5, 1, 0.8, 0, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // ===============================
                    // 5. è€³æœµç³»ç»Ÿ - åŸºäºå¤´éƒ¨å®šä½
                    // ===============================
                    
                    // å·¦è€³å¤–åœˆ
                    ctx.fillStyle = '#696969';
                    ctx.beginPath();
                    ctx.ellipse(headX - 12, headY - 15, 8, 11, -0.3, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // å³è€³å¤–åœˆ
                    ctx.beginPath();
                    ctx.ellipse(headX + 16, headY - 15, 8, 11, 0.3, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // å·¦è€³å†…åœˆ
                    ctx.fillStyle = '#808080';
                    ctx.beginPath();
                    ctx.ellipse(headX - 11, headY - 13, 5, 7, -0.3, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // å³è€³å†…åœˆ
                    ctx.beginPath();
                    ctx.ellipse(headX + 17, headY - 13, 5, 7, 0.3, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // è€³æœµæ¯›å‘ç»†èŠ‚
                    ctx.fillStyle = '#2F4F4F';
                    ctx.beginPath();
                    ctx.arc(headX - 14, headY - 19, 1.5, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(headX + 19, headY - 19, 1.5, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // ===============================
                    // 6. å‰è‚¢ç³»ç»Ÿ - åŸºäºèº«ä½“å®šä½
                    // ===============================
                    
                    // å·¦å‰è‚¢
                    ctx.fillStyle = '#696969';
                    ctx.beginPath();
                    ctx.ellipse(bodyCenterX - 8, bodyCenterY + 12, 6, 10, -0.5, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // å³å‰è‚¢
                    ctx.beginPath();
                    ctx.ellipse(bodyCenterX + 8, bodyCenterY + 12, 6, 10, 0.5, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // å·¦å‰çˆª
                    ctx.fillStyle = '#A9A9A9';
                    ctx.beginPath();
                    ctx.ellipse(bodyCenterX - 8, bodyCenterY + 20, 3, 4, 0, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // å³å‰çˆª
                    ctx.beginPath();
                    ctx.ellipse(bodyCenterX + 8, bodyCenterY + 20, 3, 4, 0, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // ===============================
                    // 7. åè‚¢ç³»ç»Ÿ - åŸºäºèº«ä½“å®šä½ï¼ˆå‘å·¦è°ƒæ•´ï¼‰
                    // ===============================
                    
                    // å·¦åè‚¢ï¼ˆå‘å·¦ç§»åŠ¨2åƒç´ ï¼‰
                    ctx.fillStyle = '#696969';
                    ctx.beginPath();
                    ctx.ellipse(bodyCenterX - 5, bodyCenterY + 25, 5, 12, 0, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // å³åè‚¢ï¼ˆå‘å·¦ç§»åŠ¨2åƒç´ ï¼‰
                    ctx.beginPath();
                    ctx.ellipse(bodyCenterX + 1, bodyCenterY + 25, 5, 12, 0, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // å·¦åçˆªï¼ˆå‘å·¦ç§»åŠ¨2åƒç´ ï¼‰
                    ctx.fillStyle = '#A9A9A9';
                    ctx.beginPath();
                    ctx.ellipse(bodyCenterX - 5, bodyCenterY + 33, 2.5, 3, 0, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // å³åçˆªï¼ˆå‘å·¦ç§»åŠ¨2åƒç´ ï¼‰
                    ctx.beginPath();
                    ctx.ellipse(bodyCenterX + 1, bodyCenterY + 33, 2.5, 3, 0, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // ===============================
                    // 8. å°¾å·´ç³»ç»Ÿ - åŸºäºèº«ä½“å®šä½ï¼ˆå‘å·¦è°ƒæ•´ï¼‰
                    // ===============================
                    
                    // å°¾å·´åŸºåº§å‘å·¦ç§»åŠ¨5åƒç´ 
                    const tailBaseX = bodyCenterX - this.bodyWidth/2 - 7; // åŸæ¥æ˜¯-2ï¼Œç°åœ¨æ”¹ä¸º-7
                    const tailBaseY = bodyCenterY + 2;
                    
                    // å°¾å·´ä¸»ä½“
                    ctx.fillStyle = '#696969';
                    ctx.beginPath();
                    ctx.ellipse(tailBaseX, tailBaseY, 18, 10, 0.6, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // å°¾å·´æ¡çº¹
                    ctx.fillStyle = '#2F4F4F';
                    ctx.beginPath();
                    ctx.ellipse(tailBaseX, tailBaseY, 18, 10, 0.6, 0.2 * Math.PI, 0.8 * Math.PI);
                    ctx.fill();
                    
                    // å°¾å·´æœ«ç«¯
                    ctx.fillStyle = '#808080';
                    ctx.beginPath();
                    ctx.ellipse(tailBaseX - 12, tailBaseY + 6, 8, 5, 0.4, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // å°¾å·´æ¯›å‘ç»†èŠ‚
                    ctx.fillStyle = '#2F4F4F';
                    for (let i = 0; i < 6; i++) {
                        const angle = 0.6 + (i / 6) * Math.PI * 1.2;
                        const radiusX = 18;
                        const radiusY = 10;
                        const hairX = tailBaseX + Math.cos(angle) * radiusX * 0.8;
                        const hairY = tailBaseY + Math.sin(angle) * radiusY * 0.8;
                        const hairSize = Math.random() * 1.5 + 1;
                        ctx.beginPath();
                        ctx.arc(hairX, hairY, hairSize, 0, Math.PI * 2);
                        ctx.fill();
                    }
                    
                    // ===============================
                    // 9. èƒ¡é¡»ç³»ç»Ÿ - åŸºäºé¢éƒ¨å®šä½
                    // ===============================
                    
                    ctx.strokeStyle = '#F5F5F5';
                    ctx.lineWidth = 1.5;
                    ctx.lineCap = 'round';
                    
                    // å·¦ä¾§èƒ¡é¡»
                    ctx.beginPath();
                    ctx.moveTo(noseX - 1, noseY);
                    ctx.lineTo(noseX - 20, noseY - 2);
                    ctx.moveTo(noseX - 1, noseY + 1);
                    ctx.lineTo(noseX - 20, noseY + 1);
                    ctx.moveTo(noseX - 1, noseY + 2);
                    ctx.lineTo(noseX - 20, noseY + 4);
                    
                    // å³ä¾§èƒ¡é¡»
                    ctx.moveTo(noseX + 1, noseY);
                    ctx.lineTo(noseX + 16, noseY - 2);
                    ctx.moveTo(noseX + 1, noseY + 1);
                    ctx.lineTo(noseX + 16, noseY + 1);
                    ctx.moveTo(noseX + 1, noseY + 2);
                    ctx.lineTo(noseX + 16, noseY + 4);
                    ctx.stroke();
                    
                    // ===============================
                    // 10. é¢ç½©ç»†èŠ‚ - åŸºäºé¢éƒ¨å®šä½
                    // ===============================
                    
                    ctx.fillStyle = '#000000';
                    ctx.globalAlpha = 0.3;
                    ctx.beginPath();
                    ctx.rect(headX - 12, headY - 2, 22, 10);
                    ctx.fill();
                    ctx.globalAlpha = 1.0;
                    
                    // ===============================
                    // 11. åŠ¨æ€æ•ˆæœ - é£è¡Œç²’å­
                    // ===============================
                    
                    // èº«ä½“å…‰æ™•
                    const gradient = ctx.createRadialGradient(
                        bodyCenterX, bodyCenterY, 0,
                        bodyCenterX, bodyCenterY, this.bodyWidth
                    );
                    gradient.addColorStop(0, 'rgba(169, 169, 169, 0.2)');
                    gradient.addColorStop(1, 'rgba(169, 169, 169, 0)');
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(bodyCenterX, bodyCenterY, this.bodyWidth, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // æ¢å¤çŠ¶æ€
                    ctx.restore();
                }
            };
            
            let pipes = [];
            let berries = [];
            let clouds = [];
            let particles = [];
            let score = 0;
            let highScore = localStorage.getItem('raccoonHighScore') || 0;
            let passedPipes = 0;
            let collectedBerries = 0;
            let gameRunning = false;
            let animationId;
            
            // åˆå§‹åŒ–æ¸¸æˆ
            function initGame() {
                raccoon.y = canvas.height / 2;
                raccoon.velocity = 0;
                pipes = [];
                berries = [];
                clouds = [];
                particles = [];
                score = 0;
                passedPipes = 0;
                collectedBerries = 0;
                scoreDisplay.textContent = score;
                
                // åˆå§‹åŒ–äº‘æœµ
                for (let i = 0; i < 4; i++) {
                    clouds.push({
                        x: Math.random() * canvas.width,
                        y: Math.random() * 150 + 50,
                        size: Math.random() * 25 + 20
                    });
                }
                
                // åˆå§‹ç®¡é“
                for (let i = 0; i < 3; i++) {
                    createPipe(canvas.width + i * 220);
                }
            }
            
            // åˆ›å»ºç®¡é“ - è°ƒæ•´ç”Ÿæˆé«˜åº¦èŒƒå›´ä»¥é€‚åº”æ–°çš„é—´è·
            function createPipe(x) {
                // è°ƒæ•´ç”Ÿæˆé«˜åº¦èŒƒå›´ï¼Œå› ä¸ºé—´éš™å˜å¤§äº†
                const gapY = Math.random() * (canvas.height - PIPE_GAP - 100) + 70;
                
                pipes.push({
                    x: x,
                    topHeight: gapY,
                    bottomY: gapY + PIPE_GAP,
                    passed: false
                });
                
                // éšæœºæµ†æœ
                if (Math.random() < BERRY_SPAWN_CHANCE) {
                    berries.push({
                        x: x + PIPE_WIDTH / 2,
                        y: gapY + PIPE_GAP / 2,
                        collected: false
                    });
                }
            }
            
            // è·³è·ƒ
            function jump() {
                if (!gameRunning) return;
                raccoon.velocity = JUMP_FORCE;
                
                // è·³è·ƒç²’å­
                for (let i = 0; i < 3; i++) {
                    particles.push({
                        x: raccoon.x - 15,
                        y: raccoon.y + Math.random() * 15 - 5,
                        vx: -1 - Math.random() * 2,
                        vy: Math.random() * 2 - 1,
                        life: 20,
                        size: Math.random() * 2 + 1
                    });
                }
            }
            
            // æ›´æ–°æ¸¸æˆ
            function update() {
                // æ›´æ–°æµ£ç†Šä½ç½®
                raccoon.velocity += GRAVITY;
                raccoon.y += raccoon.velocity;
                
                // è¾¹ç•Œæ£€æŸ¥
                if (raccoon.y - raccoon.bodyHeight/2 < 0 || raccoon.y + raccoon.bodyHeight/2 > canvas.height) {
                    endGame();
                    return;
                }
                
                // æ›´æ–°äº‘æœµ
                clouds.forEach(cloud => {
                    cloud.x -= 0.5;
                    if (cloud.x + cloud.size < 0) {
                        cloud.x = canvas.width + cloud.size;
                        cloud.y = Math.random() * 150 + 50;
                    }
                });
                
                // æ›´æ–°ç²’å­
                for (let i = particles.length - 1; i >= 0; i--) {
                    const p = particles[i];
                    p.x += p.vx;
                    p.y += p.vy;
                    p.life--;
                    if (p.life <= 0) {
                        particles.splice(i, 1);
                    }
                }
                
                // æ›´æ–°ç®¡é“
                for (let i = pipes.length - 1; i >= 0; i--) {
                    const pipe = pipes[i];
                    pipe.x -= PIPE_SPEED;
                    
                    // é€šè¿‡ç®¡é“è®¡åˆ†
                    if (!pipe.passed && pipe.x + PIPE_WIDTH < raccoon.x - raccoon.bodyWidth/2) {
                        pipe.passed = true;
                        score += 10;
                        passedPipes++;
                        scoreDisplay.textContent = score;
                    }
                    
                    // ç§»é™¤å±å¹•å¤–ç®¡é“
                    if (pipe.x + PIPE_WIDTH < 0) {
                        pipes.splice(i, 1);
                        createPipe(canvas.width);
                    }
                    
                    // ç¢°æ’æ£€æµ‹
                    if (
                        raccoon.x + raccoon.bodyWidth/2 > pipe.x &&
                        raccoon.x - raccoon.bodyWidth/2 < pipe.x + PIPE_WIDTH &&
                        (raccoon.y - raccoon.bodyHeight/2 < pipe.topHeight || 
                         raccoon.y + raccoon.bodyHeight/2 > pipe.bottomY)
                    ) {
                        endGame();
                        return;
                    }
                }
                
                // æ›´æ–°æµ†æœ
                for (let i = berries.length - 1; i >= 0; i--) {
                    const berry = berries[i];
                    berry.x -= PIPE_SPEED;
                    
                    // æ”¶é›†æµ†æœ
                    if (!berry.collected) {
                        const dx = raccoon.x - berry.x;
                        const dy = raccoon.y - berry.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < raccoon.bodyWidth/2 + BERRY_SIZE) {
                            berry.collected = true;
                            score += 20;
                            collectedBerries++;
                            scoreDisplay.textContent = score;
                            
                            // æ”¶é›†ç²’å­
                            for (let j = 0; j < 5; j++) {
                                particles.push({
                                    x: berry.x,
                                    y: berry.y,
                                    vx: (Math.random() - 0.5) * 4,
                                    vy: (Math.random() - 0.5) * 4,
                                    life: 30,
                                    size: Math.random() * 3 + 1
                                });
                            }
                            berries.splice(i, 1);
                            continue;
                        }
                    }
                    
                    // ç§»é™¤å±å¹•å¤–æµ†æœ
                    if (berry.x + BERRY_SIZE < 0) {
                        berries.splice(i, 1);
                    }
                }
            }
            
            // ç»˜åˆ¶æ¸¸æˆ
            function draw() {
                // æ¸…ç©ºç”»å¸ƒ
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // ç»˜åˆ¶èƒŒæ™¯
                const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
                gradient.addColorStop(0, '#87CEEB');
                gradient.addColorStop(1, '#B0E0E6');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // ç»˜åˆ¶äº‘æœµ
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                clouds.forEach(cloud => {
                    ctx.beginPath();
                    ctx.arc(cloud.x, cloud.y, cloud.size * 0.5, 0, Math.PI * 2);
                    ctx.arc(cloud.x + cloud.size * 0.3, cloud.y - cloud.size * 0.2, cloud.size * 0.4, 0, Math.PI * 2);
                    ctx.arc(cloud.x + cloud.size * 0.6, cloud.y, cloud.size * 0.5, 0, Math.PI * 2);
                    ctx.fill();
                });
                
                // ç»˜åˆ¶ç®¡é“
                ctx.fillStyle = '#2E8B57';
                pipes.forEach(pipe => {
                    // ä¸Šç®¡é“
                    ctx.fillRect(pipe.x, 0, PIPE_WIDTH, pipe.topHeight);
                    // ä¸‹ç®¡é“
                    ctx.fillRect(pipe.x, pipe.bottomY, PIPE_WIDTH, canvas.height - pipe.bottomY);
                    
                    // ç®¡é“è£…é¥°
                    ctx.fillStyle = '#228B22';
                    ctx.fillRect(pipe.x - 5, pipe.topHeight - 20, PIPE_WIDTH + 10, 20);
                    ctx.fillRect(pipe.x - 5, pipe.bottomY, PIPE_WIDTH + 10, 20);
                    ctx.fillStyle = '#2E8B57';
                });
                
                // ç»˜åˆ¶æµ†æœ
                berries.forEach(berry => {
                    if (!berry.collected) {
                        // æµ†æœä¸»ä½“
                        ctx.fillStyle = '#DC143C';
                        ctx.beginPath();
                        ctx.arc(berry.x, berry.y, BERRY_SIZE, 0, Math.PI * 2);
                        ctx.fill();
                        
                        // æµ†æœé«˜å…‰
                        ctx.fillStyle = '#FF69B4';
                        ctx.beginPath();
                        ctx.arc(berry.x - 4, berry.y - 4, BERRY_SIZE * 0.3, 0, Math.PI * 2);
                        ctx.fill();
                    }
                });
                
                // ç»˜åˆ¶ç²’å­
                particles.forEach(p => {
                    ctx.fillStyle = `rgba(169, 169, 169, ${p.life/20})`;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    ctx.fill();
                });
                
                // ç»˜åˆ¶æµ£ç†Š
                raccoon.draw();
            }
            
            // æ¸¸æˆä¸»å¾ªç¯
            function gameLoop() {
                update();
                draw();
                
                if (gameRunning) {
                    animationId = requestAnimationFrame(gameLoop);
                }
            }
            
            // å¼€å§‹æ¸¸æˆ
            function startGame() {
                startScreen.classList.add('hidden');
                gameOverScreen.classList.add('hidden');
                gameRunning = true;
                initGame();
                gameLoop();
            }
            
            // ç»“æŸæ¸¸æˆ
            function endGame() {
                gameRunning = false;
                cancelAnimationFrame(animationId);
                
                if (score > highScore) {
                    highScore = score;
                    localStorage.setItem('raccoonHighScore', highScore);
                }
                
                finalScoreDisplay.textContent = score;
                passedPipesDisplay.textContent = passedPipes;
                collectedBerriesDisplay.textContent = collectedBerries;
                gameHighScoreDisplay.textContent = highScore;
                
                gameOverScreen.classList.remove('hidden');
            }
            
            // è¿”å›èœå•
            function backToMenu() {
                gameOverScreen.classList.add('hidden');
                startScreen.classList.remove('hidden');
            }
            
            // äº‹ä»¶ç›‘å¬
            startBtn.addEventListener('click', startGame);
            restartBtn.addEventListener('click', startGame);
            menuBtn.addEventListener('click', backToMenu);
            
            canvas.addEventListener('click', jump);
            document.addEventListener('keydown', (e) => {
                if (e.code === 'Space') {
                    e.preventDefault();
                    jump();
                }
            });
            
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                jump();
            }, { passive: false });
            
            // åˆå§‹åŒ–æ˜¾ç¤º
            highScoreDisplay.textContent = highScore;
            gameHighScoreDisplay.textContent = highScore;
        });
    </script>
</body>
</html>
