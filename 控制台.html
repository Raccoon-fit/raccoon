<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>è°ƒè¯•æ§åˆ¶å°</title>
  <style>
    /* æ§åˆ¶å°å®¹å™¨æ ·å¼ */
    #debug-console {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 300px;
      background: #1e1e1e;
      color: #f0f0f0;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      border-top: 1px solid #444;
      z-index: 1000;
      display: flex;
      flex-direction: column;
    }
    
    /* æ§åˆ¶å°å·¥å…·æ  */
    .console-toolbar {
      background: #333;
      padding: 5px 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    /* æ§åˆ¶å°æ ‡é¢˜ */
    .console-title {
      font-weight: bold;
      color: #fff;
    }
    
    /* æ§åˆ¶å°æŒ‰é’® */
    .console-btn {
      background: #555;
      color: white;
      border: none;
      border-radius: 3px;
      padding: 3px 8px;
      margin-left: 5px;
      cursor: pointer;
      font-size: 12px;
    }
    
    .console-btn:hover {
      background: #666;
    }
    
    /* æ§åˆ¶å°å†…å®¹åŒºåŸŸ */
    .console-content {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
      white-space: pre-wrap;
      word-break: break-all;
    }
    
    /* æ—¥å¿—è¡Œæ ·å¼ */
    .log-entry {
      margin-bottom: 2px;
      line-height: 1.4;
      display: flex;
    }
    
    /* æ—¥å¿—çº§åˆ«é¢œè‰² */
    .log-log { color: #9cdcfe; }      /* console.log */
    .log-info { color: #4fc1ff; }    /* console.info */
    .log-warn { color: #ffcc66; }    /* console.warn */
    .log-error { color: #f48771; }   /* console.error */
    .log-debug { color: #b5cea8; }   /* console.debug */
    .log-assert { color: #f48771; }  /* console.assertå¤±è´¥ */
    .log-table { color: #9cdcfe; }   /* console.table */
    .log-dir { color: #9cdcfe; }     /* console.dir */
    
    /* æ—¶é—´æˆ³æ ·å¼ */
    .log-timestamp {
      color: #6e7681;
      margin-right: 8px;
      flex-shrink: 0;
    }
    
    /* æ ¼å¼åŒ–æ–‡æœ¬æ ·å¼ */
    .log-formatted {
      display: inline;
    }
    
    /* è¾“å…¥åŒºåŸŸ */
    .console-input {
      display: flex;
      border-top: 1px solid #444;
      padding: 5px;
    }
    
    /* è¾“å…¥æ¡† */
    #console-command {
      flex: 1;
      background: #252526;
      color: #f0f0f0;
      border: 1px solid #444;
      padding: 5px;
      font-family: 'Courier New', monospace;
      min-height: 20px;
      resize: vertical;
      max-height: 100px;
    }
    
    /* æ§åˆ¶å°åˆ‡æ¢æŒ‰é’® */
    #toggle-console {
      position: fixed;
      bottom: 60px;
      right: 20px;
      background: #333;
      color: white;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 18px;
      cursor: pointer;
      z-index: 1001;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    /* è¡¨æ ¼æ ·å¼ */
    .console-table {
      border-collapse: collapse;
      margin: 5px 0;
      width: 100%;
    }
    
    .console-table th, .console-table td {
      border: 1px solid #444;
      padding: 3px 8px;
      text-align: left;
    }
    
    .console-table th {
      background-color: #333;
      position: sticky;
      top: 0;
    }
    
    .console-table tr:nth-child(even) {
      background-color: #252526;
    }
    
    .console-table tr:hover {
      background-color: #333;
    }
    
    /* å¯¹è±¡ç›®å½•æ ·å¼ */
    .console-dir {
      background: #252526;
      padding: 8px;
      border-radius: 3px;
      margin: 5px 0;
      overflow-x: auto;
    }
    
    /* èµ„æºé¢æ¿æ ·å¼ */
    .resource-panel {
      display: flex;
      height: 100%;
    }
    
    .resource-tabs {
      width: 150px;
      background: #252526;
      border-right: 1px solid #444;
      overflow-y: auto;
    }
    
    .resource-tab {
      padding: 8px 10px;
      cursor: pointer;
      border-bottom: 1px solid #333;
    }
    
    .resource-tab:hover {
      background: #333;
    }
    
    .resource-tab.active {
      background: #1e1e1e;
      border-left: 3px solid #4fc1ff;
    }
    
    .resource-content {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
    }
    
    .resource-section {
      display: none;
      height: 100%;
      flex-direction: column;
    }
    
    .resource-section.active {
      display: flex;
    }
    
    /* èµ„æºè¡¨æ ¼æ ·å¼ */
    .resource-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    
    .resource-table th, .resource-table td {
      border: 1px solid #444;
      padding: 8px;
      text-align: left;
    }
    
    /* ç¼©ç•¥å›¾æ ·å¼ */
    .resource-thumbnail {
      max-width: 100px;
      max-height: 60px;
      display: block;
    }
    
    /* ç¼“å­˜ç»Ÿè®¡æ ·å¼ */
    .cache-stats {
      margin-bottom: 15px;
      padding: 10px;
      background: #252526;
      border-radius: 4px;
    }
    
    .cache-stat {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
    }
    
    .cache-stat-label {
      color: #9cdcfe;
    }
    
    .cache-stat-value {
      color: #fff;
    }
    
    /* è¿›åº¦æ¡æ ·å¼ */
    .progress-bar {
      height: 10px;
      background: #333;
      border-radius: 5px;
      margin-top: 5px;
      overflow: hidden;
    }
    
    .progress-bar-fill {
      height: 100%;
      background: #4fc1ff;
      transition: width 0.3s ease;
    }
    
    /* èµ„æºç±»å‹æ ‡ç­¾ */
    .resource-type-tag {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 12px;
      font-weight: bold;
    }
    
    .type-img { background: #4CAF50; color: white; }
    .type-script { background: #2196F3; color: white; }
    .type-css { background: #9C27B0; color: white; }
    .type-font { background: #FF9800; color: white; }
    .type-xhr { background: #607D8B; color: white; }
    .type-other { background: #795548; color: white; }
    
    /* åˆ·æ–°æŒ‰é’® */
    .refresh-btn {
      background: #555;
      color: white;
      border: none;
      border-radius: 3px;
      padding: 5px 10px;
      cursor: pointer;
      margin-left: 10px;
    }
    
    .refresh-btn:hover {
      background: #666;
    }
  </style>
</head>
<body>
  <!-- æ§åˆ¶å°åˆ‡æ¢æŒ‰é’® -->
  <button id="toggle-console" title="æ˜¾ç¤º/éšè—æ§åˆ¶å°">ğŸ“‹</button>
  
  <!-- æ§åˆ¶å°ä¸»ä½“ -->
  <div id="debug-console" style="display: none;">
    <div class="console-toolbar">
      <span class="console-title">è°ƒè¯•æ§åˆ¶å°</span>
      <div>
        <button class="console-btn" id="clear-console">æ¸…ç©º</button>
        <button class="console-btn" id="close-console">å…³é—­</button>
      </div>
    </div>
    
    <!-- èµ„æºé¢æ¿ -->
    <div class="resource-panel">
      <div class="resource-tabs">
        <div class="resource-tab active" data-tab="console">æ§åˆ¶å°</div>
        <div class="resource-tab" data-tab="cache">ç¼“å­˜å ç”¨</div>
        <div class="resource-tab" data-tab="resources">é¡µé¢èµ„æº</div>
      </div>
      
      <div class="resource-content">
        <!-- æ§åˆ¶å°å†…å®¹ -->
        <div class="resource-section active" id="console-section">
          <div class="console-content" id="console-output"></div>
          <div class="console-input">
            <textarea id="console-command" placeholder="è¾“å…¥å‘½ä»¤... (Shift+Enteræ¢è¡Œ, Enteræ‰§è¡Œ)"></textarea>
            <button class="console-btn" id="execute-command">æ‰§è¡Œ</button>
          </div>
        </div>
        
        <!-- ç¼“å­˜å ç”¨å†…å®¹ -->
        <div class="resource-section" id="cache-section">
          <div class="cache-stats">
            <h3>ç¼“å­˜ç»Ÿè®¡ <button class="refresh-btn" id="refresh-cache">åˆ·æ–°</button></h3>
            <div class="cache-stat">
              <span class="cache-stat-label">æ€»ç¼“å­˜:</span>
              <span class="cache-stat-value" id="total-cache">è®¡ç®—ä¸­...</span>
            </div>
            <div class="progress-bar">
              <div class="progress-bar-fill" id="cache-progress" style="width: 0%"></div>
            </div>
          </div>
          
          <div id="cache-details">
            <h3>ç¼“å­˜è¯¦æƒ…</h3>
            <table class="resource-table">
              <thead>
                <tr>
                  <th>ç±»å‹</th>
                  <th>åç§°</th>
                  <th>å ç”¨ç©ºé—´</th>
                  <th>é¡¹ç›®æ•°</th>
                </tr>
              </thead>
              <tbody id="cache-details-body">
                <!-- åŠ¨æ€å¡«å…… -->
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- é¡µé¢èµ„æºå†…å®¹ -->
        <div class="resource-section" id="resources-section">
          <div style="margin-bottom: 10px;">
            <h3 style="display: inline-block;">å½“å‰é¡µé¢èµ„æº</h3>
            <button class="refresh-btn" id="refresh-resources">åˆ·æ–°</button>
          </div>
          <div style="overflow-x: auto; flex: 1;">
            <table class="resource-table">
              <thead>
                <tr>
                  <th>ç±»å‹</th>
                  <th>URL</th>
                  <th>æ–‡ä»¶å</th>
                  <th>é¢„è§ˆ</th>
                  <th>å¤§å°</th>
                  <th>åŠ è½½æ—¶é—´</th>
                </tr>
              </thead>
              <tbody id="resources-body">
                <!-- åŠ¨æ€å¡«å…… -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // è‡ªå®šä¹‰æ§åˆ¶å°å®ç°
    (function() {
      // è·å–DOMå…ƒç´ 
      const consoleOutput = document.getElementById('console-output');
      const consoleCommand = document.getElementById('console-command');
      const debugConsole = document.getElementById('debug-console');
      const toggleConsole = document.getElementById('toggle-console');
      const clearConsoleBtn = document.getElementById('clear-console');
      const closeConsoleBtn = document.getElementById('close-console');
      const executeCommandBtn = document.getElementById('execute-command');
      
      // èµ„æºé¢æ¿å…ƒç´ 
      const resourceTabs = document.querySelectorAll('.resource-tab');
      const resourceSections = document.querySelectorAll('.resource-section');
      const refreshCacheBtn = document.getElementById('refresh-cache');
      const refreshResourcesBtn = document.getElementById('refresh-resources');
      
      // ç¼“å­˜ç»Ÿè®¡å…ƒç´ 
      const totalCacheEl = document.getElementById('total-cache');
      const cacheProgressEl = document.getElementById('cache-progress');
      const cacheDetailsBody = document.getElementById('cache-details-body');
      
      // é¡µé¢èµ„æºå…ƒç´ 
      const resourcesBody = document.getElementById('resources-body');
      
      // å‘½ä»¤å†å²è®°å½•
      const commandHistory = [];
      let historyIndex = -1;
      
      // åŸå§‹consoleæ–¹æ³•å¤‡ä»½
      const originalConsole = {};
      for (const key in console) {
        if (typeof console[key] === 'function') {
          originalConsole[key] = console[key].bind(console);
        }
      }
      
      // æ·»åŠ æ—¥å¿—åˆ°æ§åˆ¶å°
      function addLog(message, level = 'log', styles = null) {
        if (!consoleOutput) return;
        
        const logEntry = document.createElement('div');
        logEntry.className = `log-entry log-${level}`;
        
        // æ·»åŠ æ—¶é—´æˆ³
        const timestamp = new Date().toLocaleTimeString();
        const timestampSpan = document.createElement('span');
        timestampSpan.className = 'log-timestamp';
        timestampSpan.textContent = `[${timestamp}]`;
        logEntry.appendChild(timestampSpan);
        
        // å¤„ç†ä¸åŒç±»å‹çš„æ¶ˆæ¯
        if (level === 'table' && Array.isArray(message)) {
          // è¡¨æ ¼æ•°æ®å¤„ç†
          const infoSpan = document.createElement('span');
          infoSpan.textContent = 'è¡¨æ ¼æ•°æ®:';
          logEntry.appendChild(infoSpan);
          
          if (message.length > 0) {
            const table = document.createElement('table');
            table.className = 'console-table';
            
            // åˆ›å»ºè¡¨å¤´
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            
            const keys = Object.keys(message[0]);
            keys.forEach(key => {
              const th = document.createElement('th');
              th.textContent = key;
              headerRow.appendChild(th);
            });
            
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            // åˆ›å»ºè¡¨ä½“
            const tbody = document.createElement('tbody');
            message.forEach(item => {
              const row = document.createElement('tr');
              keys.forEach(key => {
                const td = document.createElement('td');
                td.textContent = item[key];
                row.appendChild(td);
              });
              tbody.appendChild(row);
            });
            
            table.appendChild(tbody);
            logEntry.appendChild(table);
          }
        } else if (level === 'dir' && typeof message === 'object') {
          // å¯¹è±¡ç›®å½•å¤„ç†
          const dirContainer = document.createElement('div');
          dirContainer.className = 'console-dir';
          
          const pre = document.createElement('pre');
          pre.textContent = JSON.stringify(message, null, 2);
          dirContainer.appendChild(pre);
          
          logEntry.appendChild(dirContainer);
        } else if (styles) {
          // æ ¼å¼åŒ–æ–‡æœ¬å¤„ç†
          const formattedSpan = document.createElement('span');
          formattedSpan.className = 'log-formatted';
          formattedSpan.textContent = message;
          
          // åº”ç”¨CSSæ ·å¼
          if (styles) {
            for (const prop in styles) {
              formattedSpan.style[prop] = styles[prop];
            }
          }
          
          logEntry.appendChild(formattedSpan);
        } else {
          // æ™®é€šæ–‡æœ¬å¤„ç†
          const contentSpan = document.createElement('span');
          if (typeof message === 'object') {
            contentSpan.textContent = JSON.stringify(message);
          } else {
            contentSpan.textContent = message;
          }
          logEntry.appendChild(contentSpan);
        }
        
        consoleOutput.appendChild(logEntry);
        
        // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
        consoleOutput.scrollTop = consoleOutput.scrollHeight;
        
        // è°ƒç”¨åŸå§‹æ§åˆ¶å°æ–¹æ³•
        if (originalConsole[level]) {
          originalConsole[level](message);
        }
      }
      
      // è§£æCSSæ ¼å¼å­—ç¬¦ä¸²
      function parseFormatString(format) {
        if (!format) return null;
        
        const styles = {};
        const parts = format.split(';').filter(Boolean);
        
        parts.forEach(part => {
          const [property, value] = part.split(':').map(s => s.trim());
          if (property && value) {
            styles[property] = value;
          }
        });
        
        return styles;
      }
      
      // é‡å†™consoleæ–¹æ³•
      console.log = function(...args) {
        if (args.length >= 1 && typeof args[0] === 'string' && args[0].includes('%c')) {
          // å¤„ç†æ ¼å¼åŒ–å­—ç¬¦ä¸²
          const formatParts = args[0].split('%c');
          let currentArg = 1;
          
          const message = formatParts.map((part, i) => {
            if (i === 0) return part;
            
            const styles = parseFormatString(args[currentArg++]);
            const span = document.createElement('span');
            span.className = 'log-formatted';
            span.textContent = part;
            
            if (styles) {
              for (const prop in styles) {
                span.style[prop] = styles[prop];
              }
            }
            
            return span.outerHTML;
          }).join('');
          
          addLog(message, 'log');
        } else {
          addLog(args.join(' '), 'log');
        }
      };
      
      console.info = function(...args) {
        addLog(args.join(' '), 'info');
      };
      
      console.warn = function(...args) {
        addLog(args.join(' '), 'warn');
      };
      
      console.error = function(...args) {
        addLog(args.join(' '), 'error');
      };
      
      console.debug = function(...args) {
        addLog(args.join(' '), 'debug');
      };
      
      console.assert = function(assertion, ...args) {
        if (!assertion) {
          const message = args.length > 0 ? args.join(' ') : 'Assertion failed';
          addLog(message, 'assert');
          originalConsole.assert(assertion, ...args);
        }
      };
      
      console.clear = function() {
        if (consoleOutput) consoleOutput.innerHTML = '';
        originalConsole.clear();
      };
      
      console.table = function(data) {
        if (Array.isArray(data)) {
          addLog(data, 'table');
        } else {
          addLog(data, 'log');
        }
      };
      
      console.dir = function(obj) {
        addLog(obj, 'dir');
      };
      
      // è®¡æ—¶å™¨åŠŸèƒ½
      const timers = {};
      
      console.time = function(label = 'default') {
        timers[label] = performance.now();
        originalConsole.time(label);
      };
      
      console.timeEnd = function(label = 'default') {
        if (timers[label]) {
          const duration = performance.now() - timers[label];
          addLog(`${label}: ${duration.toFixed(2)}ms`, 'info');
          delete timers[label];
        }
        originalConsole.timeEnd(label);
      };
      
      // åˆ‡æ¢èµ„æºé¢æ¿
      function switchResourceTab(tabId) {
        resourceTabs.forEach(tab => {
          tab.classList.toggle('active', tab.dataset.tab === tabId);
        });
        
        resourceSections.forEach(section => {
          section.classList.toggle('active', section.id === `${tabId}-section`);
        });
        
        // å¦‚æœåˆ‡æ¢åˆ°ç¼“å­˜æˆ–èµ„æºæ ‡ç­¾ï¼Œåˆ·æ–°æ•°æ®
        if (tabId === 'cache') {
          updateCacheStats();
        } else if (tabId === 'resources') {
          updatePageResources();
        }
      }
      
      // æ›´æ–°ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯
      async function updateCacheStats() {
        try {
          // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒStorage API
          if (!navigator.storage || !navigator.storage.estimate) {
            totalCacheEl.textContent = 'ä¸æ”¯æŒStorage API';
            return;
          }
          
          // è·å–å­˜å‚¨ä½¿ç”¨æƒ…å†µ
          const estimate = await navigator.storage.estimate();
          
          // è®¡ç®—æ€»ä½¿ç”¨é‡
          const total = estimate.usage || 0;
          const quota = estimate.quota || 1;
          const percent = Math.round((total / quota) * 100);
          
          totalCacheEl.textContent = `${formatBytes(total)} / ${formatBytes(quota)} (${percent}%)`;
          cacheProgressEl.style.width = `${percent}%`;
          
          // è·å–å„ç§ç¼“å­˜çš„è¯¦ç»†ä¿¡æ¯
          const cacheDetails = await getCacheDetails();
          renderCacheDetails(cacheDetails);
        } catch (error) {
          totalCacheEl.textContent = 'è·å–ç¼“å­˜ä¿¡æ¯å¤±è´¥';
          console.error('è·å–ç¼“å­˜ä¿¡æ¯å¤±è´¥:', error);
        }
      }
      
      // è·å–å„ç§ç¼“å­˜çš„è¯¦ç»†ä¿¡æ¯
      async function getCacheDetails() {
        const details = [];
        
        // æ£€æŸ¥æ˜¯å¦æ”¯æŒCache API
        if ('caches' in window) {
          try {
            const cacheKeys = await caches.keys();
            
            for (const key of cacheKeys) {
              const cache = await caches.open(key);
              const requests = await cache.keys();
              let totalSize = 0;
              
              // è®¡ç®—ç¼“å­˜æ€»å¤§å°
              for (const request of requests) {
                const response = await cache.match(request);
                if (response) {
                  const blob = await response.blob();
                  totalSize += blob.size;
                }
              }
              
              details.push({
                type: 'Cache Storage',
                name: key,
                size: formatBytes(totalSize),
                count: requests.length
              });
            }
          } catch (error) {
            console.error('è·å–Cache Storageä¿¡æ¯å¤±è´¥:', error);
          }
        }
        
        // æ£€æŸ¥IndexedDB
        if ('indexedDB' in window) {
          // æ³¨æ„: æµè§ˆå™¨é™åˆ¶æ— æ³•ç›´æ¥è·å–IndexedDBå¤§å°
          details.push({
            type: 'IndexedDB',
            name: 'N/A',
            size: 'N/A',
            count: 'N/A'
          });
        }
        
        // LocalStorage
        if ('localStorage' in window) {
          let lsSize = 0;
          for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            const value = localStorage.getItem(key);
            lsSize += key.length + (value ? value.length : 0);
          }
          
          details.push({
            type: 'LocalStorage',
            name: 'N/A',
            size: formatBytes(lsSize),
            count: localStorage.length
          });
        }
        
        // SessionStorage
        if ('sessionStorage' in window) {
          let ssSize = 0;
          for (let i = 0; i < sessionStorage.length; i++) {
            const key = sessionStorage.key(i);
            const value = sessionStorage.getItem(key);
            ssSize += key.length + (value ? value.length : 0);
          }
          
          details.push({
            type: 'SessionStorage',
            name: 'N/A',
            size: formatBytes(ssSize),
            count: sessionStorage.length
          });
        }
        
        // Cookie
        if (document.cookie) {
          const cookies = document.cookie.split(';');
          let cookieSize = 0;
          
          cookies.forEach(cookie => {
            cookieSize += cookie.length;
          });
          
          details.push({
            type: 'Cookies',
            name: 'N/A',
            size: formatBytes(cookieSize),
            count: cookies.length
          });
        }
        
        return details;
      }
      
      // æ¸²æŸ“ç¼“å­˜è¯¦æƒ…
      function renderCacheDetails(details) {
        cacheDetailsBody.innerHTML = '';
        
        if (details.length === 0) {
          const row = document.createElement('tr');
          row.innerHTML = '<td colspan="4" style="text-align: center;">æœªæ£€æµ‹åˆ°ç¼“å­˜æ•°æ®</td>';
          cacheDetailsBody.appendChild(row);
          return;
        }
        
        details.forEach(detail => {
          const row = document.createElement('tr');
          
          row.innerHTML = `
            <td>${detail.type}</td>
            <td>${detail.name}</td>
            <td>${detail.size}</td>
            <td>${detail.count}</td>
          `;
          
          cacheDetailsBody.appendChild(row);
        });
      }
      
      // æ›´æ–°é¡µé¢èµ„æºä¿¡æ¯
      function updatePageResources() {
        // è·å–é¡µé¢ä¸­æ‰€æœ‰èµ„æº
        const resources = performance.getEntriesByType('resource');
        
        // æ¸²æŸ“èµ„æºè¡¨æ ¼
        renderResourcesTable(resources);
      }
      
      // è·å–èµ„æºç±»å‹æ ‡ç­¾
      function getResourceTypeTag(type) {
        const typeMap = {
          'img': 'type-img',
          'script': 'type-script',
          'link': 'type-css',
          'css': 'type-css',
          'font': 'type-font',
          'xmlhttprequest': 'type-xhr'
        };
        
        const className = typeMap[type] || 'type-other';
        const displayName = type === 'xmlhttprequest' ? 'XHR' : 
                          type === 'link' ? 'CSS' : 
                          type || 'other';
        
        return `<span class="resource-type-tag ${className}">${displayName}</span>`;
      }
      
      // æ¸²æŸ“èµ„æºè¡¨æ ¼
      function renderResourcesTable(resources) {
        resourcesBody.innerHTML = '';
        
        if (resources.length === 0) {
          const row = document.createElement('tr');
          row.innerHTML = '<td colspan="6" style="text-align: center;">æœªæ£€æµ‹åˆ°èµ„æºæ•°æ®</td>';
          resourcesBody.appendChild(row);
          return;
        }
        
        resources.forEach(resource => {
          const row = document.createElement('tr');
          const url = new URL(resource.name);
          const filename = url.pathname.split('/').pop() || url.hostname;
          const type = resource.initiatorType || 'other';
          const duration = resource.duration ? resource.duration.toFixed(2) + 'ms' : 'N/A';
          
          // å°è¯•è·å–ç¼©ç•¥å›¾ï¼ˆä»…å¯¹å›¾ç‰‡æœ‰æ•ˆï¼‰
          let thumbnail = '';
          if (type === 'img' || resource.name.match(/\.(jpg|jpeg|png|gif|webp)$/i)) {
            thumbnail = `<img src="${resource.name}" class="resource-thumbnail" onerror="this.style.display='none'">`;
          }
          
          row.innerHTML = `
            <td>${getResourceTypeTag(type)}</td>
            <td><a href="${resource.name}" target="_blank" title="${resource.name}">${truncateString(resource.name, 50)}</a></td>
            <td>${filename}</td>
            <td>${thumbnail}</td>
            <td>${formatBytes(resource.transferSize || 0)}</td>
            <td>${duration}</td>
          `;
          
          resourcesBody.appendChild(row);
        });
      }
      
      // æ ¼å¼åŒ–å­—èŠ‚å¤§å°
      function formatBytes(bytes) {
        if (bytes === 0 || isNaN(bytes)) return '0 Bytes';
        
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
      }
      
      // æˆªæ–­å­—ç¬¦ä¸²
      function truncateString(str, maxLength) {
        if (str.length <= maxLength) return str;
        return str.substring(0, maxLength) + '...';
      }
      
      // åˆ‡æ¢èµ„æºæ ‡ç­¾é¡µ
      resourceTabs.forEach(tab => {
        tab.addEventListener('click', () => {
          switchResourceTab(tab.dataset.tab);
        });
      });
      
      // åˆ·æ–°ç¼“å­˜æŒ‰é’®
      refreshCacheBtn.addEventListener('click', updateCacheStats);
      
      // åˆ·æ–°èµ„æºæŒ‰é’®
      refreshResourcesBtn.addEventListener('click', updatePageResources);
      
      // åˆ‡æ¢æ§åˆ¶å°æ˜¾ç¤º/éšè—
      toggleConsole.addEventListener('click', function() {
        debugConsole.style.display = debugConsole.style.display === 'none' ? 'flex' : 'none';
        if (debugConsole.style.display === 'flex') {
          consoleCommand.focus();
        }
      });
      
      // æ¸…ç©ºæ§åˆ¶å°
      clearConsoleBtn.addEventListener('click', function() {
        console.clear();
      });
      
      // å…³é—­æ§åˆ¶å°
      closeConsoleBtn.addEventListener('click', function() {
        debugConsole.style.display = 'none';
      });
      
      // æ‰§è¡Œå‘½ä»¤
      function executeCommand() {
        const command = consoleCommand.value.trim();
        if (!command) return;
        
        // æ·»åŠ åˆ°å†å²è®°å½•
        commandHistory.push(command);
        historyIndex = commandHistory.length;
        
        addLog(`> ${command}`, 'info');
        
        try {
          // ä½¿ç”¨Functionæ„é€ å‡½æ•°åˆ›å»ºæ‰§è¡Œç¯å¢ƒ
          const result = new Function(command)();
          
          // æ˜¾ç¤ºç»“æœ
          if (result !== undefined) {
            if (typeof result === 'object') {
              console.dir(result);
            } else {
              addLog(`â† ${result}`, 'log');
            }
          }
        } catch (e) {
          addLog(`é”™è¯¯: ${e.message}`, 'error');
        }
        
        // æ¸…ç©ºè¾“å…¥æ¡†
        consoleCommand.value = '';
      }
      
      // ç»‘å®šæ‰§è¡Œå‘½ä»¤äº‹ä»¶
      executeCommandBtn.addEventListener('click', executeCommand);
      
      // å¤„ç†å‘½ä»¤è¾“å…¥
      consoleCommand.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          executeCommand();
        } else if (e.key === 'ArrowUp') {
          // ä¸Šç®­å¤´æµè§ˆå†å²
          if (commandHistory.length > 0) {
            if (historyIndex > 0) {
              historyIndex--;
              consoleCommand.value = commandHistory[historyIndex];
            }
          }
        } else if (e.key === 'ArrowDown') {
          // ä¸‹ç®­å¤´æµè§ˆå†å²
          if (commandHistory.length > 0) {
            if (historyIndex < commandHistory.length - 1) {
              historyIndex++;
              consoleCommand.value = commandHistory[historyIndex];
            } else if (historyIndex === commandHistory.length - 1) {
              historyIndex++;
              consoleCommand.value = '';
            }
          }
        }
      });
      
      // åˆå§‹æ—¥å¿—
      addLog('è°ƒè¯•æ§åˆ¶å°å·²åˆå§‹åŒ–', 'info');
      addLog('è¾“å…¥JavaScriptå‘½ä»¤å¹¶æŒ‰Enteræ‰§è¡Œ (Shift+Enteræ¢è¡Œ)', 'debug');
      
      // æš´éœ²APIåˆ°å…¨å±€
      window.debugConsole = {
        log: console.log,
        info: console.info,
        warn: console.warn,
        error: console.error,
        debug: console.debug,
        assert: console.assert,
        clear: console.clear,
        table: console.table,
        dir: console.dir,
        time: console.time,
        timeEnd: console.timeEnd,
        
        // èµ„æºç›‘æ§API
        refreshCacheStats: updateCacheStats,
        refreshPageResources: updatePageResources,
        showCachePanel: () => switchResourceTab('cache'),
        showResourcesPanel: () => switchResourceTab('resources'),
        showConsolePanel: () => switchResourceTab('console'),
        
        show: function() { 
          debugConsole.style.display = 'flex';
          consoleCommand.focus();
        },
        hide: function() { debugConsole.style.display = 'none'; }
      };
    })();
  </script>
</body>
</html>
